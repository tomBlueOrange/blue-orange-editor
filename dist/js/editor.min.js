/*!
 * Start Bootstrap -  v1.0.0 ()
 * Copyright 2013-2021 Tom Seneviratne
 * Licensed under MIT (https://github.com/BlackrockDigital/blue-orange-editor/blob/master/LICENSE)
 */

class Editor{constructor(e,t={position:"static",showToolbar:!0,toolbar:{top:0,options:["h1","h2","h3","paragraph","bold","italic","underline","link","quote","ordered","unordered","align-left","align-center","align-right","justify","decrease-indent","increase-indent","equation","color"]},placeholder:""}){this.KEY_PRESS_BUFFER=[{key:"",newLine:!1},{key:"",newLine:!1},{key:"",newLine:!1},{key:"",newLine:!1},{key:"",newLine:!1}],this.LINK_RANGE,this.EQUATION_RANGE,this.ELEMENT=e,this.UUID=this.generateUUID(),this.equationModal=!1,this.linkModal=!1,this.fixedFocus=!1,this.colorModal=!1,this.options=this.parseOptions(t),this.bubbleToolbarOpen=!1,this.changeEvent=new CustomEvent("textchange",{bubbles:!0,detail:{text:()=>this.getText()}}),this.initialiseToolbar(this.options),this.initialiseEditor(this.options),this.initialiseFloaters(),this.editor=document.getElementById("editor-window-"+this.UUID)}parseOptions(e){var t={};return null==e.position?t.position="static":t.position=e.position,null==e.showToolbar?t.showToolbar=!0:t.showToolbar=e.showToolbar,null==e.toolbar?t.toolbar={top:0,options:["h1","h2","h3","paragraph","bold","italic","underline","link","quote","ordered","unordered","align-left","align-center","align-right","justify","decrease-indent","increase-indent","equation","color"]}:(t.toolbar=e.toolbar,null==e.toolbar.top&&(t.toolbar.top=0),null==e.toolbar.options&&(t.toolbar.options=["h1","h2","h3","paragraph","bold","italic","underline","link","quote","ordered","unordered","align-left","align-center","align-right","justify","decrease-indent","increase-indent","equation","color"])),null==e.placeholder?t.placeholder="":t.placeholder=e.placeholder,t}generateUUID(){var n=(new Date).getTime(),i="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(i+t)%16|0,i=Math.floor(i/16)),("x"===e?t:3&t|8).toString(16)})}initH1Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h1-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-1"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h1()}),e}initH2Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h2-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-2"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h2()}),e}initH3Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h3-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-3"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h3()}),e}initH4Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h4-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-4"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h4()}),e}initH5Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h5-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-5"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h5()}),e}initH6Toolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","h6-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-h-6"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.h6()}),e}initParagraphToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","paragraph-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-paragraph"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.paragraph()}),e}initBoldToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","bold-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-bold"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.bold()}),e}initItalicToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","italic-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-italic"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.italic()}),e}initUnderlineToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","underline-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-underline"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.underline()}),e}initLinkToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","link-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-links-line"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.link()}),e}initQuoteToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","quote-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-chat-quote-line"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.blockQuote()}),e}initOrderedToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","order-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-list-ordered"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.order()}),e}initUnOrderedToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","unordered-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-list-unordered"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.unordered()}),e}initAlignLeftToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","align-left-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-align-left"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.justifyLeft()}),e}initAlignCenterToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","align-center-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-align-center"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.justifyCenter()}),e}initAlignRightToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","align-right-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-align-right"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.justifyRight()}),e}initAlignJustifyToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","justify-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-align-justify"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.justify()}),e}initDecreaseIndentToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","indent-decrease-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-indent-decrease"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.outdent()}),e}initIncreaseIndentToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","indent-increase-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-indent-increase"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.indent()}),e}initEquationToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control"),e.setAttribute("id","equation-control-"+this.UUID);var t=document.createElement("i");return t.setAttribute("class","ri-functions"),e.appendChild(t),e.addEventListener("mousedown",e=>{e.preventDefault(),this.equation()}),e}initColorToolbar(){var e=document.createElement("div");e.setAttribute("class","blue-orange-editor-control");var t=document.createElement("input");return t.setAttribute("id","color-control-input-"+this.UUID),t.setAttribute("class","blue-orange-color-input"),t.setAttribute("type","color"),t.addEventListener("change",()=>{this.setColor()}),t.addEventListener("blur",()=>{this.setColor()}),e.appendChild(t),e.addEventListener("mousedown",()=>{this.colorModal=!0}),e}initialiseStaticToolbar(e){var t=document.createElement("div");return t.id="blue-orange-editor-toolbar-"+this.UUID,t.className="blue-orange-editor-controls",t.style.top=e.toolbar.top,t}initialiseBubbleToolbar(){var e=document.createElement("div");return e.id="blue-orange-editor-toolbar-"+this.UUID,e.className="blue-orange-editor-controls-bubble shadow",e}initialiseFixedToolbar(){var e=document.createElement("div");return e.id="blue-orange-editor-toolbar-"+this.UUID,e.className="blue-orange-editor-controls-bubble shadow",e}initialiseToolbar(e){if(e.showToolbar){for(var t="bubble"==e.position.toLowerCase()?this.initialiseBubbleToolbar():"fixed"==e.position.toLowerCase()?this.initialiseFixedToolbar():this.initialiseStaticToolbar(e),n=0;n<e.toolbar.options.length;n++){var i=e.toolbar.options[n];"h1"==i.toLowerCase()?t.appendChild(this.initH1Toolbar()):"h2"==i.toLowerCase()?t.appendChild(this.initH2Toolbar()):"h3"==i.toLowerCase()?t.appendChild(this.initH3Toolbar()):"h4"==i.toLowerCase()?t.appendChild(this.initH4Toolbar()):"h5"==i.toLowerCase()?t.appendChild(this.initH5Toolbar()):"h6"==i.toLowerCase()?t.appendChild(this.initH6Toolbar()):"paragraph"==i.toLowerCase()?t.appendChild(this.initParagraphToolbar()):"bold"==i.toLowerCase()?t.appendChild(this.initBoldToolbar()):"italic"==i.toLowerCase()?t.appendChild(this.initItalicToolbar()):"underline"==i.toLowerCase()?t.appendChild(this.initUnderlineToolbar()):"link"==i.toLowerCase()?t.appendChild(this.initLinkToolbar()):"quote"==i.toLowerCase()?t.appendChild(this.initQuoteToolbar()):"ordered"==i.toLowerCase()?t.appendChild(this.initOrderedToolbar()):"unordered"==i.toLowerCase()?t.appendChild(this.initUnOrderedToolbar()):"align-left"==i.toLowerCase()?t.appendChild(this.initAlignLeftToolbar()):"align-center"==i.toLowerCase()?t.appendChild(this.initAlignCenterToolbar()):"align-right"==i.toLowerCase()?t.appendChild(this.initAlignRightToolbar()):"justify"==i.toLowerCase()?t.appendChild(this.initAlignJustifyToolbar()):"decrease-indent"==i.toLowerCase()?t.appendChild(this.initDecreaseIndentToolbar()):"increase-indent"==i.toLowerCase()?t.appendChild(this.initIncreaseIndentToolbar()):"equation"==i.toLowerCase()?t.appendChild(this.initEquationToolbar()):"color"==i.toLowerCase()&&t.appendChild(this.initColorToolbar())}this.ELEMENT.appendChild(t)}}initialiseEditor(e){var t=document.createElement("div");t.setAttribute("id","editor-window-"+this.UUID),t.setAttribute("contenteditable","true"),t.setAttribute("placeholder",e.placeholder),t.className="blue-orange-editor",t.addEventListener("keydown",e=>{this.addKeyPress(e.key,this.getNewLine()),this.keyPressList(),"Tab"==e.key&&e.shiftKey?(e.preventDefault(),this.outdent()):"Tab"==e.key?(e.preventDefault(),this.indent()):"Enter"==e.key?"blockquote"===document.queryCommandValue("formatBlock")&&(e.preventDefault(),document.execCommand("insertLineBreak")):"Escape"==e.key&&"blockquote"===document.queryCommandValue("formatBlock")&&(e.preventDefault(),this.outdent())}),t.addEventListener("dblclick",e=>{e=e.target;this.aDblClick(e)||this.katexDblClick(e)}),document.addEventListener("scroll",()=>{this.linkModal&&this.updateLinkFloater(),this.equationModal&&this.updateEquationFloater(),this.fixedFocus&&this.updateFixedToolbar()}),"bubble"==e.position.toLowerCase()&&document.addEventListener("mouseup",e=>{var t=document.getElementById("editor-window-"+this.UUID),e=e.target;this.isDescendantParent(t,e)?setTimeout(()=>{""!=window.getSelection().toString()?this.openBubbleToolbar():this.closeBubbleToolbar()},50):this.bubbleToolbarOpen&&setTimeout(()=>{""==window.getSelection().toString()&&this.closeBubbleToolbar()},50)}),"fixed"==e.position.toLowerCase()&&(t.addEventListener("focus",e=>{this.openFixedToolbar()}),t.addEventListener("blur",e=>{this.colorModal||this.closeFixedToolbar()}),t.addEventListener("keypress",()=>{"fixed"==e.position.toLowerCase()&&this.updateFixedToolbar()})),t.addEventListener("keyup",()=>{this.dispatch()}),t.addEventListener("paste",e=>{e.preventDefault();e=e.clipboardData?(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData?window.clipboardData.getData("Text"):"";if(document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,e);else{const t=document.getSelection().getRangeAt(0);t.deleteContents();e=document.createTextNode(e);t.insertNode(e),t.selectNodeContents(e),t.collapse(!1);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}),this.ELEMENT.appendChild(t)}generateLinkFloater(){var e=document.createElement("div");e.setAttribute("id","blue-orange-editor-link-"+this.UUID),e.className="blue-orange-editor-floater shadow",e.setAttribute("hidden",!0);var t=document.createElement("input");t.setAttribute("id","blue-orange-editor-link-input-"+this.UUID),t.className="blue-orange-editor-floater-input",t.setAttribute("placeholder","https://..."),e.appendChild(t);var n=document.createElement("div"),t=document.createElement("i");t.className="ri-check-line",n.appendChild(t),n.className="blue-orange-editor-control",n.addEventListener("click",()=>{this.addLink()}),e.appendChild(n);t=document.createElement("div"),n=document.createElement("i");return n.className="ri-close-line",t.appendChild(n),t.className="blue-orange-editor-control",t.addEventListener("click",()=>{this.removeLink()}),e.appendChild(t),e}generateEquationFloater(){var e=document.createElement("div");e.setAttribute("id","blue-orange-editor-equation-"+this.UUID),e.className="blue-orange-editor-floater shadow",e.setAttribute("hidden",!0);var t=document.createElement("input");t.setAttribute("id","blue-orange-editor-equation-input-"+this.UUID),t.className="blue-orange-editor-floater-input",t.setAttribute("placeholder","f(x)"),e.appendChild(t);var n=document.createElement("div"),t=document.createElement("i");t.className="ri-check-line",n.className="blue-orange-editor-control",n.appendChild(t),n.addEventListener("click",()=>{this.addEquation()}),e.appendChild(n);t=document.createElement("div"),n=document.createElement("i");return n.className="ri-close-line",t.appendChild(n),t.className="blue-orange-editor-control",t.addEventListener("click",()=>{this.removeEquation()}),e.appendChild(t),e}initialiseFloaters(){this.ELEMENT.appendChild(this.generateLinkFloater()),this.ELEMENT.appendChild(this.generateEquationFloater())}h1(){document.execCommand("formatBlock",!1,"<h1>"),this.dispatch()}h2(){document.execCommand("formatBlock",!1,"<h2>"),this.dispatch()}h3(){document.execCommand("formatBlock",!1,"<h3>"),this.dispatch()}h4(){document.execCommand("formatBlock",!1,"<h4>"),this.dispatch()}h5(){document.execCommand("formatBlock",!1,"<h5>"),this.dispatch()}h6(){document.execCommand("formatBlock",!1,"<h6>"),this.dispatch()}bold(){document.execCommand("bold"),this.dispatch()}italic(){document.execCommand("italic"),this.dispatch()}underline(){document.execCommand("underline"),this.dispatch()}justifyLeft(){this.getSurroundingContainer().style.textAlign="left",this.dispatch()}justifyCenter(){this.getSurroundingContainer().style.textAlign="center",this.dispatch()}justifyRight(){this.getSurroundingContainer().style.textAlign="right",this.dispatch()}justify(){this.getSurroundingContainer().style.textAlign="justify",this.dispatch()}unordered(){document.execCommand("insertUnorderedList"),this.dispatch()}order(){document.execCommand("insertOrderedList"),this.dispatch()}paragraph(){document.execCommand("formatBlock",!1,"div"),this.dispatch()}blockQuote(){document.execCommand("formatBlock",!1,"<blockquote>"),this.dispatch()}indent(){document.execCommand("indent"),this.dispatch()}outdent(){document.execCommand("outdent"),this.dispatch()}setColor(){this.colorModal=!1;var e=document.getElementById("color-control-input-"+this.UUID).value;document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,e),this.dispatch()}surroundElement(t){try{(n=window.getSelection()).rangeCount&&((i=n.getRangeAt(0).cloneRange()).surroundContents(t),n.removeAllRanges(),n.addRange(i)),window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}catch(e){var n,i;(n=window.getSelection()).rangeCount&&(i=n.getRangeAt(0).cloneRange(),t.appendChild(i.extractContents()),i.insertNode(t)),window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}}insertNode(e){var t=window.getSelection();t.rangeCount&&(t=t.getRangeAt(0).cloneRange(),e.appendChild(t.extractContents()),t.insertNode(e)),window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}insertLinkFloater(){setTimeout(()=>{this.linkModal=!0},500);var e=document.getElementById("blue-orange-editor-selection").getBoundingClientRect().top,t=e-52,n=e+document.getElementById("blue-orange-editor-selection").offsetHeight+10,i=document.getElementById("blue-orange-editor-selection").getBoundingClientRect().left+document.getElementById("blue-orange-editor-selection").offsetWidth/2,o=Math.max(10,i-175),e=window.innerWidth,i=window.innerHeight;e<o+350&&(o=Math.max(e/2-175,10));e=document.getElementById("blue-orange-editor-link-"+this.UUID);e.style.left=o+"px",e.style.top=i-50<n+42?t+"px":n+"px",e.style.display="flex",e.setAttribute("class","blue-orange-editor-floater shadow"),document.getElementById("blue-orange-editor-link-input-"+this.UUID).value=""}getCaretGlobalPosition(){const n=document.getSelection();if(n.rangeCount){var i=n.getRangeAt(0);const o=i.startContainer;i=i.startOffset;let e,t;if(0<i)return t=document.createRange(),t.setStart(o,i-1),t.setEnd(o,i),e=t.getBoundingClientRect(),{left:e.left,top:e.top,bottom:e.bottom,right:e.right};if(0==i)return t=document.createRange(),t.setStart(o,i),t.setEnd(o,i),e=t.getBoundingClientRect(),{left:e.left,top:e.top,bottom:e.bottom,right:e.right};if(o.getBoundingClientRect)return o.getBoundingClientRect()}return{left:-9999,top:-9999}}openBubbleToolbar(){this.bubbleToolbarOpen=!0;var e=this.getCaretGlobalPosition(),t=document.getElementById("editor-window-"+this.UUID),n=t.getBoundingClientRect().top-50,i=t.getBoundingClientRect().left,n=Math.max(n,52),o=document.getElementById("blue-orange-editor-toolbar-"+this.UUID);o.style.display="flex";t=e.top,t=Math.max(t-52,n),n=i-o.offsetWidth/2,i=e.left+(e.right-e.left)/2-o.offsetWidth/2,e=Math.max(10,Math.max(i,n)),i=e+o.offsetWidth,n=window.innerWidth;n<i&&(e=Math.max(n/2-175,10)),o.style.left=e+"px",o.style.top=t+"px"}openFixedToolbar(){this.fixedFocus=!0,document.getElementById("blue-orange-editor-toolbar-"+this.UUID).style.display="flex",this.updateFixedToolbar()}updateFixedToolbar(){var e=document.getElementById("editor-window-"+this.UUID),t=e.getBoundingClientRect().top-50,n=e.getBoundingClientRect().left,i=n+(e.getBoundingClientRect().right-n)/2,o=document.getElementById("blue-orange-editor-toolbar-"+this.UUID),e=Math.max(t,this.options.toolbar.top),n=i-o.offsetWidth/2,t=Math.max(10,n),i=t+o.offsetWidth,n=window.innerWidth;n<i&&(t=Math.max(n/2-175,10)),o.style.left=t+"px",o.style.top=e+"px"}closeBubbleToolbar(){this.bubbleToolbarOpen=!1,document.getElementById("blue-orange-editor-toolbar-"+this.UUID).style.display="none"}closeFixedToolbar(){this.linkModal||this.equationModal||(document.getElementById("blue-orange-editor-toolbar-"+this.UUID).style.display="none")}updateLinkFloater(){var e=document.getElementById("blue-orange-editor-selection").getBoundingClientRect().top,t=e-52,n=e+document.getElementById("blue-orange-editor-selection").offsetHeight+10,i=document.getElementById("blue-orange-editor-selection").getBoundingClientRect().left+document.getElementById("blue-orange-editor-selection").offsetWidth/2,o=Math.max(10,i-175),e=window.innerWidth,i=window.innerHeight;e<o+350&&(o=Math.max(e/2-175,10));e=document.getElementById("blue-orange-editor-link-"+this.UUID);e.style.left=o+"px",e.style.top=i-50<n+42?t+"px":n+"px"}link(){var e,t;window.getSelection&&((e=document.createElement("div")).id="blue-orange-editor-selection",e.className="blue-orange-editor-selection",(t=window.getSelection()).rangeCount&&(this.LINK_RANGE=t.getRangeAt(0).cloneRange()),this.surroundElement(e),this.insertLinkFloater())}validURL(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}removeLink(){this.linkModal=!1;var e=document.getElementById("blue-orange-editor-selection"),t=document.getElementById("blue-orange-editor-link-"+this.UUID);t.setAttribute("class","blue-orange-editor-floater shadow"),t.style.display="none";t=e.innerHTML;e.outerHTML=t,this.dispatch();e=window.getSelection();e.removeAllRanges(),LINK_RANGE.setEnd(LINK_RANGE.startContainer,LINK_RANGE.startOffset+t.length),e.addRange(LINK_RANGE)}addLink(){var e,t,n,i=document.getElementById("blue-orange-editor-link-input-"+this.UUID).value;this.validURL(i)?((t=document.createElement("a")).setAttribute("href",i),e=document.getElementById("blue-orange-editor-selection"),(n=document.getElementById("blue-orange-editor-link-"+this.UUID)).toggleAttribute("hidden"),n.style.display="none",(i=e.innerHTML).endsWith(" ")?(t.appendChild(document.createTextNode(i.trim())),e.outerHTML=t.outerHTML+" "):(t.appendChild(document.createTextNode(i)),e.outerHTML=t.outerHTML),this.linkModal=!1,this.dispatch(),(t=window.getSelection()).removeAllRanges(),LINK_RANGE.setEnd(LINK_RANGE.startContainer,LINK_RANGE.startOffset+i.length),t.addRange(LINK_RANGE)):((n=document.getElementById("blue-orange-editor-link-"+this.UUID)).setAttribute("class","blue-orange-editor-floater blue-orange-editor-floater-error shadow animate__animated animate__shakeX"),setTimeout(()=>{n.setAttribute("class","blue-orange-editor-floater blue-orange-editor-floater-error shadow")},1e3))}insertEquationFloater(){this.equationModal=!0;var e=document.getElementById("blue-orange-editor-equation-selection").getBoundingClientRect().top,t=e-52,n=e+document.getElementById("blue-orange-editor-equation-selection").offsetHeight+10,i=document.getElementById("blue-orange-editor-equation-selection").getBoundingClientRect().left+document.getElementById("blue-orange-editor-equation-selection").offsetWidth/2,o=Math.max(10,i-175),e=window.innerWidth,i=window.innerHeight;e<o+350&&(o=Math.max(e/2-175,10));e=document.getElementById("blue-orange-editor-equation-"+this.UUID);e.style.left=o+"px",e.style.top=i-50<n+42?t+"px":n+"px",e.style.display="flex",e.setAttribute("class","blue-orange-editor-floater shadow"),document.getElementById("blue-orange-editor-equation-input-"+this.UUID).value=""}updateEquationFloater(){var e=document.getElementById("blue-orange-editor-equation-selection").getBoundingClientRect().top,t=e-52,n=e+document.getElementById("blue-orange-editor-equation-selection").offsetHeight+10,i=document.getElementById("blue-orange-editor-equation-selection").getBoundingClientRect().left+document.getElementById("blue-orange-editor-equation-selection").offsetWidth/2,o=Math.max(10,i-175),e=window.innerWidth,i=window.innerHeight;e<o+350&&(o=Math.max(e/2-175,10));e=document.getElementById("blue-orange-editor-equation-"+this.UUID);e.style.left=o+"px",e.style.top=i-50<n+42?t+"px":n+"px"}equation(){var e,t;window.getSelection&&((e=document.createElement("div")).id="blue-orange-editor-equation-selection",e.className="blue-orange-editor-selection blue-orange-editor-equation",(t=document.createElement("i")).setAttribute("class","ri-functions"),e.appendChild(t),e.appendChild(document.createTextNode("New Equation")),(t=window.getSelection()).rangeCount&&(this.EQUATION_RANGE=t.getRangeAt(0).cloneRange()),this.insertNode(e),this.insertEquationFloater())}removeEquation(){this.equationModal=!1;var e=document.getElementById("blue-orange-editor-equation-selection"),t=document.getElementById("blue-orange-editor-equation-"+this.UUID);t.setAttribute("class","blue-orange-editor-floater shadow"),t.style.display="none",e.outerHTML="",this.dispatch();e=window.getSelection();e.removeAllRanges(),e.addRange(EQUATION_RANGE)}parseEquation(e){return katex.renderToString(e,{throwOnError:!0})}addEquation(){var e=document.getElementById("blue-orange-editor-equation-input-"+this.UUID).value;try{var t=this.parseEquation(e),n=document.createElement("span");n.setAttribute("class","blue-orange-editor-equation-cont"),n.setAttribute("contenteditable","false");var i,o=document.getElementById("blue-orange-editor-equation-selection");(i=document.getElementById("blue-orange-editor-equation-"+this.UUID)).toggleAttribute("hidden"),i.style.display="none",n.innerHTML=t,o.outerHTML=n.outerHTML+" ",this.equationModal=!1,this.dispatch();var r=window.getSelection();r.removeAllRanges(),EQUATION_RANGE.setEnd(EQUATION_RANGE.startContainer,EQUATION_RANGE.startOffset+n.length),r.addRange(EQUATION_RANGE)}catch(e){(i=document.getElementById("blue-orange-editor-equation-"+this.UUID)).setAttribute("class","blue-orange-editor-floater blue-orange-editor-floater-error shadow animate__animated animate__shakeX"),setTimeout(()=>{i.setAttribute("class","blue-orange-editor-floater blue-orange-editor-floater-error shadow")},1e3)}}addKeyPress(e,t){for(this.KEY_PRESS_BUFFER.splice(0,0,{key:e,newLine:t});5<this.KEY_PRESS_BUFFER.length;)this.KEY_PRESS_BUFFER.splice(this.KEY_PRESS_BUFFER.length-1,1)}getNewLine(){for(var e=window.getSelection().getRangeAt(0).cloneRange(),t=e.startOffset,n=e.startContainer,i=n.tagName;null==i||"div"!=i.toLowerCase();)i=(n=n.parentElement).tagName;var o=t<=0,t=n.isEqualNode(e.startContainer),e=null!=n.childNodes[0]&&n.childNodes[0].isEqualNode(e.startContainer);return o&&(t||e)}getSurroundingContainer(){for(var e=window.getSelection().getRangeAt(0).cloneRange(),t=(e.startOffset,e.startContainer),n=t.tagName;null==n||"div"!=n.toLowerCase();)n=(t=t.parentElement).tagName;return t}isNumber(e){return"1"==e||"2"==e||"3"==e||"4"==e||"5"==e||"6"==e||"7"==e||"8"==e||"9"==e||"0"==e}keyPressList(){if(2<=this.KEY_PRESS_BUFFER.length)if("-"==this.KEY_PRESS_BUFFER[1].key&&this.KEY_PRESS_BUFFER[1].newLine&&" "==this.KEY_PRESS_BUFFER[0].key){this.unordered();var t=window.getSelection().getRangeAt(0).cloneRange().startContainer;try{t.nodeValue=t.nodeValue.substring(1,t.nodeValue.length)}catch(e){t.nodeValue=""}}else if(this.isNumber("1"==this.KEY_PRESS_BUFFER[2].key)&&this.KEY_PRESS_BUFFER[2].newLine&&"."==this.KEY_PRESS_BUFFER[1].key&&" "==this.KEY_PRESS_BUFFER[0].key){this.order();t=window.getSelection().getRangeAt(0).cloneRange().startContainer;try{t.nodeValue=t.nodeValue.substring(2,t.nodeValue.length)}catch(e){t.nodeValue=""}}}isDescendant(e,t){try{for(var n=t.parentNode;null!=n;){if(n.tagName.toLowerCase()===e.toLowerCase())return n;n=n.parentNode}return null}catch(e){return null}}isDescendantClassName(e,t){try{for(var n=t.parentNode;null!=n;){if(n.className.toLowerCase()===e.toLowerCase())return n;n=n.parentNode}return null}catch(e){return null}}isDescendantParent(e,t){try{if(e===t)return!0;for(var n=t.parentNode;null!=n;){if(n===e)return!0;n=n.parentNode}return!1}catch(e){return!1}}aDblClick(e){if("a"!=e.tagName.toLowerCase())return null!=this.isDescendant("a",e)&&(n=(i=this.isDescendant("a",e)).getAttribute("href"),(t=document.createElement("div")).id="blue-orange-editor-selection",t.className="blue-orange-editor-selection",t.innerHTML=i.innerHTML,i.outerHTML=t.outerHTML,o=document.getElementById("blue-orange-editor-selection"),(i=document.createRange()).selectNodeContents(o),this.LINK_RANGE=i,this.insertLinkFloater(),document.getElementById("blue-orange-editor-link-input-"+this.UUID).value=n),!1;var t,n=e.getAttribute("href");(t=document.createElement("div")).id="blue-orange-editor-selection",t.className="blue-orange-editor-selection",t.innerHTML=e.innerHTML,e.outerHTML=t.outerHTML;var i,o=document.getElementById("blue-orange-editor-selection");return(i=document.createRange()).selectNodeContents(o),this.LINK_RANGE=i,this.insertLinkFloater(),document.getElementById("blue-orange-editor-link-input-"+this.UUID).value=n,!0}getChildClassName(e,t){for(var n=t.childNodes,i=0;i<n.length;i++)if(n[i].className.toLowerCase()==e.toLowerCase())return n[i];return null}getChildTagName(e,t){for(var n=t.childNodes,i=0;i<n.length;i++)if(n[i].tagName.toLowerCase()==e.toLowerCase())return n[i];return null}katexGetEquation(e){e=this.getChildClassName("katex-mathml",e),e=this.getChildTagName("math",e),e=this.getChildTagName("semantics",e);return this.getChildTagName("annotation",e).innerHTML}katexDblClick(e){var t,n,i,o,r;"katex"==e.className.toLowerCase()?(t=this.katexGetEquation(e),(n=document.createElement("div")).id="blue-orange-editor-equation-selection",n.className="blue-orange-editor-selection blue-orange-editor-equation",(i=document.createElement("i")).setAttribute("class","ri-functions"),n.appendChild(i),n.appendChild(document.createTextNode("Edit Equation")),e.parentElement.outerHTML=n.outerHTML,o=document.getElementById("blue-orange-editor-equation-selection"),(r=document.createRange()).selectNodeContents(o),this.EQUATION_RANGE=r,this.insertEquationFloater(),document.getElementById("blue-orange-editor-equation-input-"+this.UUID).value=t):null!=this.isDescendantClassName("katex",e)&&(e=this.isDescendantClassName("katex",e),t=this.katexGetEquation(e),(n=document.createElement("div")).id="blue-orange-editor-equation-selection",n.className="blue-orange-editor-selection blue-orange-editor-equation",(i=document.createElement("i")).setAttribute("class","ri-functions"),n.appendChild(i),n.appendChild(document.createTextNode("Edit Equation")),e.parentElement.outerHTML=n.outerHTML,o=document.getElementById("blue-orange-editor-equation-selection"),(r=document.createRange()).selectNodeContents(o),this.EQUATION_RANGE=r,this.insertEquationFloater(),document.getElementById("blue-orange-editor-equation-input-"+this.UUID).value=t)}setText(e){document.getElementById("editor-window-"+this.UUID).innerHTML=e}getText(){return document.getElementById("editor-window-"+this.UUID).innerHTML}dispatch(){document.getElementById("editor-window-"+this.UUID).dispatchEvent(this.changeEvent)}}